<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QFL Circuit Builder</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: #0d1117;
            color: #f0f6fc;
            overflow: hidden;
            display: flex;
            height: 100vh;
        }
        
        /* Sidebar */
        .sidebar {
            width: 220px;
            background: #161b22;
            border-right: 1px solid #30363d;
            display: flex;
            flex-direction: column;
        }
        
        .sidebar-header {
            padding: 16px;
            border-bottom: 1px solid #30363d;
        }
        
        .sidebar-header h2 {
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #8b949e;
        }
        
        .component-palette {
            flex: 1;
            overflow-y: auto;
            padding: 12px;
        }
        
        .component-category {
            margin-bottom: 16px;
        }
        
        .category-title {
            font-size: 11px;
            color: #6e7681;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }
        
        .component-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 10px;
            background: #21262d;
            border: 1px solid #30363d;
            border-radius: 6px;
            margin-bottom: 6px;
            cursor: grab;
            transition: all 0.2s;
            font-size: 12px;
        }
        
        .component-item:hover {
            background: #30363d;
            border-color: #58a6ff;
        }
        
        .component-item:active {
            cursor: grabbing;
        }
        
        .component-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }
        
        .sidebar-footer {
            padding: 12px;
            border-top: 1px solid #30363d;
        }
        
        .btn {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-secondary {
            background: #21262d;
            color: #f0f6fc;
            border: 1px solid #30363d;
        }
        
        .btn-secondary:hover {
            background: #30363d;
        }
        
        .btn-danger {
            background: #f85149;
            color: white;
            margin-top: 8px;
        }
        
        .btn-danger:hover {
            background: #ff6b6b;
        }
        
        /* Main Canvas Area */
        .main-area {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .toolbar {
            height: 48px;
            background: #161b22;
            border-bottom: 1px solid #30363d;
            display: flex;
            align-items: center;
            padding: 0 16px;
            gap: 12px;
        }
        
        .toolbar h1 {
            font-size: 14px;
            font-weight: 600;
            margin-right: auto;
        }
        
        .tool-btn {
            padding: 6px 12px;
            background: #21262d;
            border: 1px solid #30363d;
            color: #f0f6fc;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
        }
        
        .tool-btn:hover {
            background: #30363d;
        }
        
        .tool-btn.active {
            background: #58a6ff;
            color: #0d1117;
            border-color: #58a6ff;
        }
        
        .canvas-container {
            flex: 1;
            overflow: auto;
            background: #0d1117;
            position: relative;
        }
        
        #breadboard {
            min-width: 1000px;
            min-height: 600px;
            position: relative;
        }
        
        /* Breadboard Background */
        .board-background {
            position: absolute;
            top: 50px;
            left: 50px;
            width: 900px;
            height: 500px;
            background: #f5f5dc;
            border-radius: 4px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }
        
        /* Power Rails */
        .power-rail {
            position: absolute;
            left: 0;
            right: 0;
            height: 25px;
            display: flex;
        }
        
        .power-rail.top { top: 10px; }
        .power-rail.bottom { bottom: 10px; }
        
        .rail-section {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
        }
        
        .rail-red { background: #ffcccc; color: #cc0000; }
        .rail-blue { background: #ccccff; color: #0000cc; }
        
        /* Main Grid */
        .board-grid {
            position: absolute;
            top: 50px;
            left: 50px;
            right: 50px;
            bottom: 50px;
            display: grid;
            grid-template-columns: repeat(63, 1fr);
            gap: 0;
        }
        
        .hole {
            width: 100%;
            aspect-ratio: 1;
            background: #d4d4aa;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .hole::after {
            content: '';
            width: 40%;
            height: 40%;
            background: #8b7355;
            border-radius: 50%;
        }
        
        .hole.occupied::after {
            background: #4a90d9;
        }
        
        /* Components on board */
        .component {
            position: absolute;
            cursor: grab;
            user-select: none;
            z-index: 10;
            transition: transform 0.1s;
        }
        
        .component:hover {
            z-index: 20;
        }
        
        .component.dragging {
            cursor: grabbing;
            z-index: 100;
            opacity: 0.8;
        }
        
        .component.selected {
            filter: drop-shadow(0 0 4px #58a6ff);
        }
        
        /* Component Styles */
        .comp-arduino {
            width: 120px;
            height: 160px;
            background: #2d5016;
            border-radius: 4px;
            border: 2px solid #1a3009;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px;
        }
        
        .comp-arduino .usb {
            width: 30px;
            height: 20px;
            background: #666;
            border-radius: 2px;
            margin-bottom: 8px;
        }
        
        .comp-arduino .chip {
            width: 40px;
            height: 40px;
            background: #1a1a2e;
            border-radius: 4px;
            margin: auto;
        }
        
        .comp-arduino .pins {
            display: flex;
            gap: 4px;
            font-size: 8px;
            color: #fff;
        }
        
        .comp-resistor {
            width: 80px;
            height: 20px;
            background: linear-gradient(90deg, 
                #c4a35a 0%, #c4a35a 15%,
                #d4b86a 15%, #d4b86a 25%,
                #c4a35a 25%, #c4a35a 35%,
                #d4b86a 35%, #d4b86a 45%,
                #c4a35a 45%, #c4a35a 55%,
                #d4b86a 55%, #d4b86a 65%,
                #c4a35a 65%, #c4a35a 75%,
                #d4b86a 75%, #d4b86a 85%,
                #c4a35a 85%, #c4a35a 100%
            );
            border-radius: 2px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .comp-resistor::before,
        .comp-resistor::after {
            content: '';
            position: absolute;
            width: 15px;
            height: 2px;
            background: #888;
        }
        
        .comp-resistor::before { left: -15px; }
        .comp-resistor::after { right: -15px; }
        
        .comp-led {
            width: 24px;
            height: 24px;
            background: #ff4444;
            border-radius: 50% 50% 0 0;
            border: 2px solid #cc0000;
            position: relative;
        }
        
        .comp-led::after {
            content: '';
            position: absolute;
            bottom: -12px;
            left: 50%;
            transform: translateX(-50%);
            width: 16px;
            height: 12px;
            background: #888;
            border-radius: 0 0 2px 2px;
        }
        
        .comp-led.on {
            background: #ff6666;
            box-shadow: 0 0 20px #ff4444;
        }
        
        .comp-capacitor {
            width: 30px;
            height: 40px;
            background: #2d5a3d;
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 1px solid #1a3d28;
        }
        
        .comp-capacitor::after {
            content: '+';
            color: #fff;
            font-size: 14px;
            font-weight: bold;
        }
        
        .comp-mosfet {
            width: 40px;
            height: 30px;
            background: #1a1a2e;
            border-radius: 2px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 10px;
            font-weight: bold;
            border: 1px solid #333;
        }
        
        .comp-relay {
            width: 60px;
            height: 50px;
            background: #4a3728;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 10px;
            border: 1px solid #2d1f14;
        }
        
        .comp-sensor {
            width: 50px;
            height: 40px;
            background: #2e4057;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 9px;
            text-align: center;
            border: 1px solid #1a2738;
        }
        
        .comp-piezo {
            width: 100px;
            height: 60px;
            background: #3d2817;
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 10px;
            border: 1px solid #26180d;
        }
        
        .comp-piezo .hv-warning {
            color: #ff6666;
            font-size: 8px;
            margin-top: 4px;
        }
        
        .comp-wire {
            position: absolute;
            height: 3px;
            background: #ff4444;
            transform-origin: left center;
            pointer-events: none;
            z-index: 5;
        }
        
        .comp-wire.blue { background: #4444ff; }
        .comp-wire.yellow { background: #ffcc00; }
        .comp-wire.green { background: #44ff44; }
        .comp-wire.white { background: #cccccc; }
        
        /* Connection points */
        .connection-point {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #888;
            border-radius: 50%;
            border: 1px solid #555;
        }
        
        /* Info Panel */
        .info-panel {
            position: fixed;
            right: 20px;
            top: 70px;
            width: 250px;
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 16px;
            z-index: 200;
        }
        
        .info-panel h3 {
            font-size: 13px;
            margin-bottom: 12px;
            color: #58a6ff;
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 12px;
        }
        
        .info-label {
            color: #8b949e;
        }
        
        .info-value {
            color: #f0f6fc;
            font-family: monospace;
        }
        
        /* Context Menu */
        .context-menu {
            position: fixed;
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 4px;
            z-index: 1000;
            display: none;
            min-width: 150px;
        }
        
        .context-menu-item {
            padding: 8px 12px;
            cursor: pointer;
            font-size: 12px;
            border-radius: 4px;
        }
        
        .context-menu-item:hover {
            background: #21262d;
        }
        
        .context-menu-item.danger {
            color: #f85149;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="sidebar-header">
            <h2>Components</h2>
        </div>
        <div class="component-palette">
            <div class="component-category">
                <div class="category-title">Microcontrollers</div>
                <div class="component-item" draggable="true" data-type="arduino">
                    <span class="component-icon">üü©</span>
                    <span>Arduino Nano</span>
                </div>
            </div>
            
            <div class="component-category">
                <div class="category-title">Power Components</div>
                <div class="component-item" draggable="true" data-type="mosfet">
                    <span class="component-icon">‚ö°</span>
                    <span>MOSFET (IRLZ44N)</span>
                </div>
                <div class="component-item" draggable="true" data-type="relay">
                    <span class="component-icon">üîå</span>
                    <span>Relay Module</span>
                </div>
            </div>
            
            <div class="component-category">
                <div class="category-title">HV Generation</div>
                <div class="component-item" draggable="true" data-type="piezo">
                    <span class="component-icon">‚ö°</span>
                    <span>Piezo Igniter</span>
                </div>
            </div>
            
            <div class="component-category">
                <div class="category-title">Passive</div>
                <div class="component-item" draggable="true" data-type="resistor">
                    <span class="component-icon">„Ä∞Ô∏è</span>
                    <span>Resistor</span>
                </div>
                <div class="component-item" draggable="true" data-type="capacitor">
                    <span class="component-icon">‚è∫Ô∏è</span>
                    <span>Capacitor</span>
                </div>
                <div class="component-item" draggable="true" data-type="led">
                    <span class="component-icon">üí°</span>
                    <span>LED</span>
                </div>
            </div>
            
            <div class="component-category">
                <div class="category-title">Sensors</div>
                <div class="component-item" draggable="true" data-type="temp-sensor">
                    <span class="component-icon">üå°Ô∏è</span>
                    <span>Temperature</span>
                </div>
                <div class="component-item" draggable="true" data-type="current-sensor">
                    <span class="component-icon">üìä</span>
                    <span>Current (INA219)</span>
                </div>
            </div>
        </div>
        <div class="sidebar-footer">
            <button class="btn btn-secondary" onclick="autoLayout()">Auto Layout</button>
            <button class="btn btn-danger" onclick="clearBoard()">Clear Board</button>
        </div>
    </div>
    
    <div class="main-area">
        <div class="toolbar">
            <h1>üîß Circuit Builder</h1>
            <button class="tool-btn active" data-tool="select">Select</button>
            <button class="tool-btn" data-tool="wire">Wire</button>
            <button class="tool-btn" data-tool="delete">Delete</button>
            <div style="margin-left: auto;">
                <button class="tool-btn" onclick="simulateCircuit()">‚ñ∂ Simulate</button>
                <button class="tool-btn" onclick="exportCircuit()">üíæ Export</button>
            </div>
        </div>
        
        <div class="canvas-container" id="canvasContainer">
            <div id="breadboard">
                <div class="board-background">
                    <div class="power-rail top">
                        <div class="rail-section rail-red">+12V</div>
                        <div class="rail-section rail-red">+12V</div>
                        <div class="rail-section rail-blue">GND</div>
                        <div class="rail-section rail-blue">GND</div>
                    </div>
                    <div class="power-rail bottom">
                        <div class="rail-section rail-blue">GND</div>
                        <div class="rail-section rail-blue">GND</div>
                        <div class="rail-section rail-red">+5V</div>
                        <div class="rail-section rail-red">+5V</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="info-panel">
        <h3>Circuit Info</h3>
        <div class="info-row">
            <span class="info-label">Components:</span>
            <span class="info-value" id="compCount">0</span>
        </div>
        <div class="info-row">
            <span class="info-label">Connections:</span>
            <span class="info-value" id="connCount">0</span>
        </div>
        <div class="info-row">
            <span class="info-label">Power Draw:</span>
            <span class="info-value" id="powerDraw">0W</span>
        </div>
        <div class="info-row">
            <span class="info-label">Status:</span>
            <span class="info-value" id="circuitStatus">Unverified</span>
        </div>
    </div>
    
    <div class="context-menu" id="contextMenu">
        <div class="context-menu-item" onclick="rotateComponent()">Rotate</div>
        <div class="context-menu-item" onclick="deleteComponent()">Delete</div>
        <div class="context-menu-item danger" onclick="deleteAllWires()">Delete All Wires</div>
    </div>

    <script>
        const breadboard = document.getElementById('breadboard');
        const canvasContainer = document.getElementById('canvasContainer');
        const contextMenu = document.getElementById('contextMenu');
        
        let components = [];
        let wires = [];
        let selectedComponent = null;
        let currentTool = 'select';
        let isDragging = false;
        let dragOffset = { x: 0, y: 0 };
        let wireStart = null;
        let nextId = 1;
        
        // Tool selection
        document.querySelectorAll('.tool-btn[data-tool]').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tool-btn[data-tool]').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentTool = btn.dataset.tool;
            });
        });
        
        // Drag from palette
        document.querySelectorAll('.component-item').forEach(item => {
            item.addEventListener('dragstart', (e) => {
                e.dataTransfer.setData('component-type', item.dataset.type);
            });
        });
        
        breadboard.addEventListener('dragover', (e) => {
            e.preventDefault();
        });
        
        breadboard.addEventListener('drop', (e) => {
            e.preventDefault();
            const type = e.dataTransfer.getData('component-type');
            if (type) {
                const rect = breadboard.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                addComponent(type, x, y);
            }
        });
        
        function addComponent(type, x, y) {
            const comp = document.createElement('div');
            comp.className = `component comp-${type}`;
            comp.id = `comp-${nextId++}`;
            comp.style.left = `${x - 40}px`;
            comp.style.top = `${y - 20}px`;
            
            // Component-specific content
            const content = getComponentContent(type);
            comp.innerHTML = content;
            
            breadboard.appendChild(comp);
            
            const componentData = {
                id: comp.id,
                type: type,
                element: comp,
                x: x - 40,
                y: y - 20,
                rotation: 0,
                connections: []
            };
            
            components.push(componentData);
            
            // Event listeners
            comp.addEventListener('mousedown', (e) => onComponentMouseDown(e, componentData));
            comp.addEventListener('contextmenu', (e) => onComponentContextMenu(e, componentData));
            
            updateInfo();
        }
        
        function getComponentContent(type) {
            const contents = {
                arduino: `
                    <div class="usb"></div>
                    <div class="chip"></div>
                    <div style="color:#fff;font-size:8px;margin-top:4px;">Arduino</div>
                `,
                mosfet: 'MOSFET',
                relay: 'RELAY',
                resistor: '',
                capacitor: '',
                led: '',
                piezo: `
                    <div>PIEZO</div>
                    <div class="hv-warning">‚ö† HV 30kV</div>
                `,
                'temp-sensor': 'TEMP',
                'current-sensor': 'CURRENT'
            };
            return contents[type] || '';
        }
        
        function onComponentMouseDown(e, comp) {
            e.stopPropagation();
            
            if (currentTool === 'delete') {
                deleteComponentById(comp.id);
                return;
            }
            
            if (currentTool === 'wire') {
                if (!wireStart) {
                    wireStart = comp;
                    comp.element.classList.add('selected');
                } else {
                    if (wireStart !== comp) {
                        createWire(wireStart, comp);
                    }
                    wireStart.element.classList.remove('selected');
                    wireStart = null;
                }
                return;
            }
            
            // Select mode
            selectComponent(comp);
            isDragging = true;
            
            const rect = comp.element.getBoundingClientRect();
            const boardRect = breadboard.getBoundingClientRect();
            dragOffset = {
                x: e.clientX - rect.left,
                y: e.clientY - rect.top
            };
        }
        
        function selectComponent(comp) {
            document.querySelectorAll('.component').forEach(c => c.classList.remove('selected'));
            selectedComponent = comp;
            if (comp) comp.element.classList.add('selected');
        }
        
        function onComponentContextMenu(e, comp) {
            e.preventDefault();
            selectedComponent = comp;
            contextMenu.style.display = 'block';
            contextMenu.style.left = `${e.clientX}px`;
            contextMenu.style.top = `${e.clientY}px`;
        }
        
        // Global mouse events
        document.addEventListener('mousemove', (e) => {
            if (isDragging && selectedComponent) {
                const boardRect = breadboard.getBoundingClientRect();
                const x = e.clientX - boardRect.left - dragOffset.x;
                const y = e.clientY - boardRect.top - dragOffset.y;
                
                selectedComponent.x = x;
                selectedComponent.y = y;
                selectedComponent.element.style.left = `${x}px`;
                selectedComponent.element.style.top = `${y}px`;
                
                updateWires(selectedComponent);
            }
        });
        
        document.addEventListener('mouseup', () => {
            isDragging = false;
        });
        
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.context-menu')) {
                contextMenu.style.display = 'none';
            }
        });
        
        function createWire(from, to) {
            const wire = document.createElement('div');
            wire.className = 'comp-wire';
            breadboard.insertBefore(wire, breadboard.firstChild);
            
            const wireData = {
                element: wire,
                from: from,
                to: to
            };
            
            wires.push(wireData);
            from.connections.push(wireData);
            to.connections.push(wireData);
            
            updateWirePosition(wireData);
            updateInfo();
        }
        
        function updateWirePosition(wire) {
            const fromRect = wire.from.element.getBoundingClientRect();
            const toRect = wire.to.element.getBoundingClientRect();
            const boardRect = breadboard.getBoundingClientRect();
            
            const x1 = fromRect.left + fromRect.width / 2 - boardRect.left;
            const y1 = fromRect.top + fromRect.height / 2 - boardRect.top;
            const x2 = toRect.left + toRect.width / 2 - boardRect.left;
            const y2 = toRect.top + toRect.height / 2 - boardRect.top;
            
            const length = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
            const angle = Math.atan2(y2 - y1, x2 - x1) * 180 / Math.PI;
            
            wire.element.style.width = `${length}px`;
            wire.element.style.left = `${x1}px`;
            wire.element.style.top = `${y1}px`;
            wire.element.style.transform = `rotate(${angle}deg)`;
        }
        
        function updateWires(comp) {
            comp.connections.forEach(wire => updateWirePosition(wire));
        }
        
        function deleteComponentById(id) {
            const index = components.findIndex(c => c.id === id);
            if (index === -1) return;
            
            const comp = components[index];
            
            // Remove connected wires
            [...comp.connections].forEach(wire => {
                const wireIndex = wires.indexOf(wire);
                if (wireIndex > -1) {
                    wires.splice(wireIndex, 1);
                    wire.element.remove();
                }
                // Remove from other component
                const other = wire.from === comp ? wire.to : wire.from;
                const otherIndex = other.connections.indexOf(wire);
                if (otherIndex > -1) other.connections.splice(otherIndex, 1);
            });
            
            comp.element.remove();
            components.splice(index, 1);
            
            if (selectedComponent === comp) {
                selectedComponent = null;
            }
            
            updateInfo();
        }
        
        function rotateComponent() {
            if (!selectedComponent) return;
            selectedComponent.rotation = (selectedComponent.rotation + 90) % 360;
            selectedComponent.element.style.transform = `rotate(${selectedComponent.rotation}deg)`;
            updateWires(selectedComponent);
            contextMenu.style.display = 'none';
        }
        
        function deleteComponent() {
            if (selectedComponent) {
                deleteComponentById(selectedComponent.id);
            }
            contextMenu.style.display = 'none';
        }
        
        function deleteAllWires() {
            wires.forEach(wire => wire.element.remove());
            wires = [];
            components.forEach(c => c.connections = []);
            updateInfo();
            contextMenu.style.display = 'none';
        }
        
        function clearBoard() {
            components.forEach(c => c.element.remove());
            wires.forEach(w => w.element.remove());
            components = [];
            wires = [];
            selectedComponent = null;
            updateInfo();
        }
        
        function autoLayout() {
            // Simple auto-layout algorithm
            const positions = {
                arduino: { x: 100, y: 200 },
                mosfet: { x: 250, y: 150 },
                relay: { x: 250, y: 250 },
                piezo: { x: 400, y: 150 },
                'temp-sensor': { x: 400, y: 250 }
            };
            
            components.forEach(comp => {
                const pos = positions[comp.type];
                if (pos) {
                    comp.x = pos.x;
                    comp.y = pos.y;
                    comp.element.style.left = `${pos.x}px`;
                    comp.element.style.top = `${pos.y}px`;
                    updateWires(comp);
                }
            });
        }
        
        function updateInfo() {
            document.getElementById('compCount').textContent = components.length;
            document.getElementById('connCount').textContent = wires.length;
            
            // Calculate estimated power draw
            let power = 0;
            components.forEach(c => {
                const powerMap = {
                    arduino: 0.25,
                    mosfet: 0.5,
                    relay: 1,
                    piezo: 6,
                    led: 0.02
                };
                power += powerMap[c.type] || 0;
            });
            document.getElementById('powerDraw').textContent = power.toFixed(1) + 'W';
        }
        
        function simulateCircuit() {
            // Simple simulation - flash LEDs and check connections
            document.querySelectorAll('.comp-led').forEach(led => {
                led.classList.add('on');
                setTimeout(() => led.classList.remove('on'), 1000);
            });
            
            const hasArduino = components.some(c => c.type === 'arduino');
            const hasMosfet = components.some(c => c.type === 'mosfet');
            const hasPiezo = components.some(c => c.type === 'piezo');
            
            const status = document.getElementById('circuitStatus');
            if (hasArduino && hasMosfet && hasPiezo) {
                status.textContent = '‚úì Valid';
                status.style.color = '#3fb950';
                alert('Circuit simulation: Valid!\n\nAll required components present.\nEstimated operation: NORMAL');
            } else {
                status.textContent = '‚ö† Incomplete';
                status.style.color = '#d29922';
                alert('Circuit simulation: Incomplete\n\nMissing: ' + 
                    [!hasArduino && 'Arduino', !hasMosfet && 'MOSFET', !hasPiezo && 'Piezo'].filter(Boolean).join(', '));
            }
        }
        
        function exportCircuit() {
            const circuit = {
                components: components.map(c => ({
                    type: c.type,
                    x: c.x,
                    y: c.y,
                    rotation: c.rotation
                })),
                connections: wires.map(w => ({
                    from: w.from.id,
                    to: w.to.id
                }))
            };
            
            const data = JSON.stringify(circuit, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'rpat_circuit.json';
            a.click();
            URL.revokeObjectURL(url);
        }
        
        // Initialize with example components
        window.addEventListener('load', () => {
            // Add some example components
            addComponent('arduino', 150, 250);
            addComponent('mosfet', 300, 200);
            addComponent('piezo', 500, 200);
            addComponent('led', 300, 350);
            addComponent('resistor', 220, 350);
        });
    </script>
</body>
</html>
